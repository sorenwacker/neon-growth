<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circuit Board Animation Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: black;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-width: 200px;
        }

        .controls h3 {
            margin: 0 0 15px 0;
            font-size: 14px;
            color: #333;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .control-group input[type="range"] {
            width: 100%;
        }

        .control-group .value {
            display: inline-block;
            font-size: 12px;
            color: #333;
            font-weight: 600;
            margin-left: 5px;
        }

        button {
            width: 100%;
            padding: 8px;
            background: #0077cc;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
        }

        button:hover {
            background: #005fa3;
        }

        .stats {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            font-size: 12px;
            color: #666;
        }

        .stats div {
            margin: 3px 0;
        }

        .toggle-ui {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #666;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .toggle-ui:hover {
            background: rgba(255, 255, 255, 1);
            color: #333;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="toggle-ui" id="toggle-ui">Hide UI</div>

    <div class="controls">
        <h3>Controls</h3>

        <div class="control-group">
            <label>
                Hex Size (px)
                <span class="value" id="grid-value">100</span>
            </label>
            <input type="range" id="grid" min="50" max="200" value="100" step="10">
        </div>

        <div class="control-group">
            <label>
                Max Cars
                <span class="value" id="cars-value">30</span>
            </label>
            <input type="range" id="cars" min="1" max="50" value="30" step="1">
        </div>

        <div class="control-group">
            <label>
                Trace Lifetime (sec)
                <span class="value" id="trace-lifetime-value">2.0</span>
            </label>
            <input type="range" id="trace-lifetime" min="0.5" max="10" value="2.0" step="0.5">
        </div>

        <div class="control-group">
            <label>
                Line Width
                <span class="value" id="width-value">120</span>
            </label>
            <input type="range" id="width" min="1" max="150" value="120" step="1">
        </div>

        <div class="control-group">
            <label>
                Step Delay (ms)
                <span class="value" id="delay-value">25</span>
            </label>
            <input type="range" id="delay" min="10" max="500" value="25" step="5">
        </div>

        <div class="control-group">
            <label>
                Spawn Delay (ms)
                <span class="value" id="spawn-delay-value">500</span>
            </label>
            <input type="range" id="spawn-delay" min="100" max="2000" value="500" step="100">
        </div>

        <div class="control-group">
            <label>
                Mutation Rate (%)
                <span class="value" id="mutation-rate-value">10</span>
            </label>
            <input type="range" id="mutation-rate" min="0" max="50" value="10" step="5">
        </div>

        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
            <h4 style="font-size: 12px; margin-bottom: 10px; color: #666;">Presets</h4>
            <button id="preset-sparse" style="margin-bottom: 5px;">Sparse (5 cars, 100px)</button>
            <button id="preset-dense" style="margin-bottom: 5px;">Dense (10 cars, 50px)</button>
        </div>

        <button id="reset">Reset Animation</button>
    </div>


    <script src="js/circuit-board.js"></script>

    <script>
        // Set theme to light for demo
        document.documentElement.setAttribute('data-theme', 'light');

        // Controls
        const gridSlider = document.getElementById('grid');
        const carsSlider = document.getElementById('cars');
        const traceLifetimeSlider = document.getElementById('trace-lifetime');
        const widthSlider = document.getElementById('width');
        const delaySlider = document.getElementById('delay');
        const spawnDelaySlider = document.getElementById('spawn-delay');
        const mutationRateSlider = document.getElementById('mutation-rate');
        const resetBtn = document.getElementById('reset');

        gridSlider.addEventListener('input', function() {
            document.getElementById('grid-value').textContent = this.value;
            // Grid size change requires full reset
            if (window.circuitBoardInstance) {
                window.circuitBoardInstance.destroy();
                setTimeout(() => {
                    window.circuitBoardInstance = new CircuitBoard({
                        hexSize: parseInt(gridSlider.value),
                        maxCars: parseInt(carsSlider.value),
                        traceLifetime: parseFloat(traceLifetimeSlider.value),
                        lineWidth: parseFloat(widthSlider.value),
                        stepDelay: parseInt(delaySlider.value),
                        spawnDelay: parseInt(spawnDelaySlider.value),
                        mutationRate: parseInt(mutationRateSlider.value) / 100
                    });
                    window.circuitBoardInstance.theme = 'light';
                }, 100);
            }
        });

        carsSlider.addEventListener('input', function() {
            document.getElementById('cars-value').textContent = this.value;
            if (window.circuitBoardInstance) {
                window.circuitBoardInstance.maxCars = parseInt(this.value);
            }
        });

        traceLifetimeSlider.addEventListener('input', function() {
            document.getElementById('trace-lifetime-value').textContent = this.value;
            if (window.circuitBoardInstance) {
                var lifetime = parseFloat(this.value);
                window.circuitBoardInstance.traceLifetime = lifetime;
                // Recalculate fadeAlpha and fadeTime based on new lifetime
                var totalFrames = 60 * lifetime;
                var fadeAlpha = 1 - Math.pow(0.01, 1 / totalFrames);
                window.circuitBoardInstance.fadeAlpha = Math.min(0.2, Math.max(0.001, fadeAlpha));
                window.circuitBoardInstance.fadeTime = lifetime * 1000;
            }
        });

        widthSlider.addEventListener('input', function() {
            document.getElementById('width-value').textContent = this.value;
            if (window.circuitBoardInstance) {
                window.circuitBoardInstance.lineWidth = parseFloat(this.value);
            }
        });

        delaySlider.addEventListener('input', function() {
            document.getElementById('delay-value').textContent = this.value;
            if (window.circuitBoardInstance) {
                window.circuitBoardInstance.stepDelay = parseInt(this.value);
            }
        });

        spawnDelaySlider.addEventListener('input', function() {
            document.getElementById('spawn-delay-value').textContent = this.value;
            if (window.circuitBoardInstance) {
                window.circuitBoardInstance.spawnDelay = parseInt(this.value);
            }
        });

        mutationRateSlider.addEventListener('input', function() {
            document.getElementById('mutation-rate-value').textContent = this.value;
            if (window.circuitBoardInstance) {
                window.circuitBoardInstance.mutationRate = parseInt(this.value) / 100; // Convert % to decimal
            }
        });

        resetBtn.addEventListener('click', function() {
            if (window.circuitBoardInstance) {
                window.circuitBoardInstance.destroy();
            }
            setTimeout(() => {
                window.circuitBoardInstance = new CircuitBoard({
                    hexSize: parseInt(gridSlider.value),
                    maxCars: parseInt(carsSlider.value),
                    traceLifetime: parseFloat(traceLifetimeSlider.value),
                    lineWidth: parseFloat(widthSlider.value),
                    stepDelay: parseInt(delaySlider.value),
                    spawnDelay: parseInt(spawnDelaySlider.value)
                });
                window.circuitBoardInstance.theme = 'light';
            }, 100);
        });

        // Preset buttons - layer on top without clearing
        function applyPresetLayer(hexSize, maxCars, lineWidth) {
            gridSlider.value = hexSize;
            carsSlider.value = maxCars;
            widthSlider.value = lineWidth;
            document.getElementById('grid-value').textContent = hexSize;
            document.getElementById('cars-value').textContent = maxCars;
            document.getElementById('width-value').textContent = lineWidth;

            if (window.circuitBoardInstance) {
                // Keep existing canvas and drawings - just change settings
                window.circuitBoardInstance.hexSize = hexSize;
                window.circuitBoardInstance.maxCars = maxCars;
                window.circuitBoardInstance.lineWidth = lineWidth;

                // Clear cars and reset state but keep canvas drawings
                window.circuitBoardInstance.cars = [];
                window.circuitBoardInstance.occupiedCells = {};
                window.circuitBoardInstance.allLines = [];
                window.circuitBoardInstance.animationComplete = false;
                window.circuitBoardInstance.finalDotsDrawn = false;

                // Spawn new cars with new settings
                for (var i = 0; i < maxCars; i++) {
                    window.circuitBoardInstance.spawnCar();
                }
            }
        }

        document.getElementById('preset-sparse').addEventListener('click', function() {
            applyPresetLayer(100, 5, 120);
        });

        document.getElementById('preset-dense').addEventListener('click', function() {
            applyPresetLayer(50, 10, 25);
        });

        // Toggle UI visibility
        const toggleBtn = document.getElementById('toggle-ui');
        const controlsBox = document.querySelector('.controls');
        const statsBox = document.querySelector('.stats');
        let uiVisible = true;

        toggleBtn.addEventListener('click', function() {
            uiVisible = !uiVisible;
            if (uiVisible) {
                controlsBox.classList.remove('hidden');
                statsBox.classList.remove('hidden');
                toggleBtn.textContent = 'Hide UI';
            } else {
                controlsBox.classList.add('hidden');
                statsBox.classList.add('hidden');
                toggleBtn.textContent = 'Show UI';
            }
        });

        // Initialize animation on load
        window.circuitBoardInstance = new CircuitBoard({
            hexSize: parseInt(gridSlider.value),
            maxCars: parseInt(carsSlider.value),
            traceLifetime: parseFloat(traceLifetimeSlider.value),
            lineWidth: parseFloat(widthSlider.value),
            stepDelay: parseInt(delaySlider.value),
            spawnDelay: parseInt(spawnDelaySlider.value),
            mutationRate: parseInt(mutationRateSlider.value) / 100
        });
        window.circuitBoardInstance.theme = 'light';

    </script>
</body>
</html>
